<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ray's 67th Birthday Celebration</title>
    <meta name="description" content="Celebrate Ray's 67th Birthday at Waterlefe Golf & River Club">
    <link rel="icon" type="image/png" href="Ray-favicon.png">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#1a3a5c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Ray's Birthday">
    <link rel="apple-touch-icon" href="Ray-favicon.png">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a3a5c 0%, #0f2138 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        .container { max-width: 500px; margin: 0 auto; }
        .screen {
            display: none;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: fadeIn 0.3s ease;
        }
        .screen.active { display: block; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .profile-photo {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: block;
            border: 4px solid #d4af37;
            object-fit: cover;
        }
        h1 {
            color: #1a3a5c;
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }
        .event-details {
            text-align: center;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }
        .explanation {
            background: #f8f9fa;
            border-left: 4px solid #d4af37;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
            color: #555;
            line-height: 1.6;
        }
        .btn {
            width: 100%;
            padding: 16px;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px 0;
        }
        .btn-primary {
            background: #1a3a5c;
            color: white;
        }
        .btn-primary:hover {
            background: #0f2138;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26,58,92,0.3);
        }
        .btn-secondary {
            background: #d4af37;
            color: white;
        }
        .btn-secondary:hover {
            background: #b8941f;
            transform: translateY(-2px);
        }
        input {
            width: 100%;
            padding: 16px;
            font-size: 1rem;
            border: 2px solid #ddd;
            border-radius: 12px;
            margin: 15px 0;
        }
        input:focus {
            outline: none;
            border-color: #1a3a5c;
        }
        .dashboard-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .user-name {
            font-size: 1.5rem;
            color: #1a3a5c;
            margin-bottom: 10px;
        }
        .coin-count {
            font-size: 2.5rem;
            font-weight: bold;
            color: #d4af37;
        }
        .coins-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 30px 0;
            min-height: 250px;
            align-items: center;
            justify-items: center;
        }
        .coin {
            aspect-ratio: 1;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at 30% 30%, #f5f5f5, #d0d0d0, #c0c0c0);
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(255,255,255,0.8),
                inset 0 -2px 4px rgba(0,0,0,0.2);
            animation: coinPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            padding: 3px;
        }
        @keyframes coinPop {
            0% { transform: scale(0) rotate(0deg); }
            50% { transform: scale(1.1) rotate(180deg); }
            100% { transform: scale(1) rotate(360deg); }
        }
        .coin img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        .coin.blue { 
            border: 10px solid #4A90E2;
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(255,255,255,0.8),
                inset 0 -2px 4px rgba(0,0,0,0.2),
                0 0 0 2px rgba(74,144,226,0.3);
        }
        .coin.purple { 
            border: 10px solid #9B59B6;
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(255,255,255,0.8),
                inset 0 -2px 4px rgba(0,0,0,0.2),
                0 0 0 2px rgba(155,89,182,0.3);
        }
        .coin.orange { 
            border: 10px solid #E67E22;
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(255,255,255,0.8),
                inset 0 -2px 4px rgba(0,0,0,0.2),
                0 0 0 2px rgba(230,126,34,0.3);
        }
        .coin.gold { 
            border: 10px solid #d4af37;
            box-shadow: 
                0 8px 20px rgba(0,0,0,0.3),
                inset 0 2px 4px rgba(255,255,255,0.8),
                inset 0 -2px 4px rgba(0,0,0,0.2),
                0 0 0 2px rgba(212,175,55,0.3);
        }
        .coin.ray-special {
            border: 12px solid #d4af37;
            box-shadow: 
                0 10px 30px rgba(212,175,55,0.5),
                inset 0 3px 6px rgba(255,255,255,0.9),
                inset 0 -3px 6px rgba(0,0,0,0.2),
                0 0 0 3px rgba(212,175,55,0.4),
                0 0 25px rgba(212,175,55,0.6);
        }
        .coin-type-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            background: white;
            border-radius: 50%;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border: 2px solid #fff;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1000;
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .coin-option {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin: 15px 0;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }
        .coin-option:hover {
            transform: translateX(5px);
            border-color: #1a3a5c;
        }
        .coin-option-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 5px;
        }
        .coin-icon { font-size: 2rem; }
        .coin-option-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #1a3a5c;
        }
        .coin-option-desc {
            color: #666;
            font-size: 0.9rem;
            margin-left: 60px;
        }
        .leaderboard-list { margin: 20px 0; }
        .leaderboard-item {
            background: #f8f9fa;
            padding: 15px 20px;
            border-radius: 12px;
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .leaderboard-item.ray-highlight {
            background: linear-gradient(135deg, #fff9e6 0%, #ffe9a8 100%);
            border: 3px solid #d4af37;
        }
        .player-info { flex: 1; }
        .player-name {
            font-weight: 600;
            font-size: 1.1rem;
            color: #1a3a5c;
        }
        .player-coins {
            margin-top: 5px;
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }
        .mini-coin {
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .mini-coin img {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            object-fit: cover;
        }
        .mini-coin.blue { border: 2px solid #4A90E2; }
        .mini-coin.purple { border: 2px solid #9B59B6; }
        .mini-coin.orange { border: 2px solid #E67E22; }
        .mini-coin.gold { border: 2px solid #d4af37; }
        .coin-count-display {
            font-size: 1.5rem;
            font-weight: bold;
            color: #d4af37;
            min-width: 40px;
            text-align: right;
        }
        .voice-recorder {
            text-align: center;
            padding: 20px 0;
        }
        .record-button {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: none;
            font-size: 2.5rem;
            cursor: pointer;
            transition: all 0.3s;
            background: #e74c3c;
            color: white;
            margin: 20px 0;
        }
        .record-button:hover { transform: scale(1.1); }
        .record-button.recording {
            animation: pulse 1.5s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: #e74c3c;
            margin: 10px 0;
        }
        .back-button {
            background: #95a5a6;
            color: white;
            margin-top: 10px;
        }
        .back-button:hover { background: #7f8c8d; }
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .gallery-item {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
        }
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        .filter-btn {
            flex: 1;
            min-width: 80px;
            padding: 10px;
            border-radius: 8px;
            border: 2px solid #ddd;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        .filter-btn.active {
            background: #1a3a5c;
            color: white;
            border-color: #1a3a5c;
        }
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }
        .coin-collection-section {
            margin: 30px 0;
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a3a5c;
            margin-bottom: 20px;
            text-align: center;
        }

        .coin-card {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 20px;
            border: 3px solid transparent;
            transition: all 0.3s;
            cursor: pointer;
        }

        .coin-card:hover {
            border-color: #1a3a5c;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .coin-card-visual {
            flex-shrink: 0;
        }

        .coin-card-visual .coin {
            width: 80px;
            height: 80px;
        }

        .coin-card-info {
            flex: 1;
        }

        .coin-card-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1a3a5c;
            margin-bottom: 5px;
        }

        .coin-card-desc {
            font-size: 0.9rem;
            color: #666;
        }

        .coin-card-action {
            flex-shrink: 0;
        }

        .btn-claim {
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            background: #1a3a5c;
            color: white;
        }

        .btn-claim:hover {
            background: #0f2138;
            transform: scale(1.05);
        }

        .btn-claim.record {
            background: #d4af37;
        }

        .btn-claim.record:hover {
            background: #b8941f;
        }
        .admin-section {
            background: linear-gradient(135deg, #1a3a5c 0%, #0f2138 100%);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .admin-title {
            color: #d4af37;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .btn-export {
            background: #d4af37;
            color: white;
            padding: 15px 30px;
            font-size: 1rem;
            font-weight: 600;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-export:hover {
            background: #b8941f;
            transform: translateY(-2px);
        }
        .photo-upload-section {
            background: #f8f9fa;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .photo-upload-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #1a3a5c;
            margin-bottom: 15px;
        }

        .photo-upload-input {
            display: none;
        }

        .photo-upload-button {
            display: inline-block;
            padding: 15px 30px;
            background: #d4af37;
            color: white;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 10px;
        }

        .photo-upload-button:hover {
            background: #b8941f;
            transform: translateY(-2px);
        }

        .photo-preview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .photo-preview-item {
            position: relative;
            aspect-ratio: 1;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .photo-preview-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .photo-caption {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0,0,0,0.7));
            color: white;
            padding: 8px;
            font-size: 0.8rem;
            text-align: left;
        }

        .photo-delete {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(231,76,60,0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-weight: bold;
        }

        .photo-caption-input {
            width: 100%;
            padding: 8px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        .photo-gallery-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .photo-gallery-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
        }

        .photo-gallery-info {
            padding: 12px;
        }

        .photo-gallery-caption {
            font-size: 0.9rem;
            color: #333;
            margin-bottom: 5px;
        }

        .photo-gallery-uploader {
            font-size: 0.8rem;
            color: #666;
        }
        .goal-tracker {
            background: linear-gradient(135deg, #fff9e6 0%, #ffe9a8 100%);
            border: 3px solid #d4af37;
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .goal-title {
            font-size: 1rem;
            color: #1a3a5c;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .goal-progress {
            font-size: 2.5rem;
            font-weight: bold;
            color: #d4af37;
            margin: 10px 0;
        }

        .goal-progress-bar {
            background: #fff;
            height: 24px;
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .goal-progress-fill {
            background: linear-gradient(90deg, #d4af37 0%, #b8941f 100%);
            height: 100%;
            transition: width 0.5s ease;
            border-radius: 12px;
        }

        .goal-percentage {
            font-size: 1.1rem;
            color: #666;
            font-weight: 600;
        }

        .goal-message {
            font-size: 0.9rem;
            color: #666;
            margin-top: 10px;
        }

        .coin-value-badge {
            display: inline-block;
            background: #d4af37;
            color: white;
            font-size: 0.8rem;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 12px;
            margin-left: 8px;
        }
    </style>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
</head>
<body>
    <div class="container">
        <div id="welcomeScreen" class="screen active">
<img src="Ray-photo.png" class="profile-photo" alt="Ray">
            <h1>Welcome to Ray's 67th Birthday Celebration!</h1>
            <div class="event-details">
                <strong>January 4, 2026</strong><br>
                Waterlefe Golf & River Club
            </div>
            <div class="explanation">
                Help us collect 67 coins for Ray's 67th birthday! Throughout the round, add a coin for every birdie, eagle or hot streak and two coins when you send Ray a birthday message. Every coin becomes a memory Ray can treasure forever!
            </div>
            <button class="btn btn-primary" onclick="showScreen('loginScreen')">Enter</button>
        </div>

        <div id="loginScreen" class="screen">
<img src="Ray-photo.png" class="profile-photo" alt="Ray">
            <h1>Join the Celebration</h1>
            <input type="text" id="playerName" placeholder="Enter your name" onkeypress="if(event.key==='Enter') login()">
            <button class="btn btn-primary" onclick="login()">Join</button>
            <button class="btn back-button" onclick="showScreen('welcomeScreen')">Back</button>
        </div>

        <div id="dashboardScreen" class="screen">
            <div class="dashboard-header">
                <div class="user-name" id="dashboardName"></div>
            </div>
            
            <div class="goal-tracker">
                <div class="goal-title">Ray's 67th Birthday Goal</div>
                <div class="goal-progress"><span id="totalCoins">0</span> / 67</div>
                <div class="goal-progress-bar">
                    <div class="goal-progress-fill" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="goal-percentage" id="goalPercentage">0% there!</div>
                <div class="goal-message">Let's collect 67 coins for Ray today! </div>
            </div>
            
           <div class="coin-collection-section">
    <div class="section-title">Collect Your Coins</div>

    <div class="coin-card" onclick="claimCoin('birdie')">
        <div class="coin-card-visual">
            <div class="coin blue">
                <img src="Ray-photo.png" id="birdiePreview" alt="Ray Coin">
            </div>
        </div>
        <div class="coin-card-info">
            <div class="coin-card-name">Birdie Coin</div>
            <div class="coin-card-desc">One under par <span class="coin-value-badge">1 COIN</span></div>
        </div>
        <div class="coin-card-action">
            <button class="btn-claim">Claim</button>
        </div>
    </div>

    <div class="coin-card" onclick="claimCoin('eagle')">
        <div class="coin-card-visual">
            <div class="coin purple">
                <img src="Ray-photo.png" id="eaglePreview" alt="Ray Coin">
            </div>
        </div>
        <div class="coin-card-info">
            <div class="coin-card-name">Eagle Coin</div>
            <div class="coin-card-desc">Two under par <span class="coin-value-badge">1 COIN</span></div>
        </div>
        <div class="coin-card-action">
            <button class="btn-claim">Claim</button>
        </div>
    </div>

    <div class="coin-card" onclick="claimCoin('hotStreak')">
        <div class="coin-card-visual">
            <div class="coin orange">
                <img src="Ray-photo.png" id="hotStreakPreview" alt="Ray Coin">
            </div>
        </div>
        <div class="coin-card-info">
            <div class="coin-card-name">Hot Streak Coin</div>
            <div class="coin-card-desc">Three pars in a row <span class="coin-value-badge">1 COIN</span></div>
        </div>
        <div class="coin-card-action">
            <button class="btn-claim">Claim</button>
        </div>
    </div>

    <div class="coin-card" onclick="showVoiceRecorder()">
        <div class="coin-card-visual">
            <div class="coin gold">
                <img src="Ray-photo.png" id="wishesPreview" alt="Ray Coin">
            </div>
        </div>
        <div class="coin-card-info">
            <div class="coin-card-name">Birthday Wishes</div>
            <div class="coin-card-desc">Send birthday message <span class="coin-value-badge">2 COINS</span></div>
        </div>
        <div class="coin-card-action">
            <button class="btn-claim record">Record</button>
        </div>
    </div>
</div>


            <div class="photo-upload-section">
                <div class="photo-upload-title">Add Photos from Today</div>
                <label for="photoUpload" class="photo-upload-button">
                    Upload Photos
                </label>
                <input type="file" id="photoUpload" class="photo-upload-input" accept="image/*" multiple onchange="handlePhotoUpload(event)">
                <div id="photoPreviewGrid" class="photo-preview-grid"></div>
            </div>

            <div id="adminSection" class="admin-section" style="display: none;">
                <div class="admin-title">Admin Controls</div>
                <button class="btn-export" onclick="exportMemoryBook()">Export Ray's Memory Book</button>
                <button class="btn-export" onclick="clearAllData()" style="background: #e74c3c; margin-top: 10px;">Clear All Data</button>
            </div>

            <button class="btn btn-secondary" onclick="showLeaderboard()">Birthday Golfers</button>
            <button class="btn btn-secondary" onclick="showGallery()">View Gallery</button>
        </div>

        <div id="leaderboardScreen" class="screen">
            <h1>Birthday Golfers</h1>
            <div class="leaderboard-list" id="leaderboardList"></div>
            <button class="btn back-button" onclick="showScreen('dashboardScreen')">Back to Dashboard</button>
        </div>

        <div id="galleryScreen" class="screen">
            <h1>Memory Gallery</h1>
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterGallery('all')">All</button>
                <button class="filter-btn" onclick="filterGallery('coins')">Coins</button>
                <button class="filter-btn" onclick="filterGallery('photos')">Photos</button>
                <button class="filter-btn" onclick="filterGallery('birdie')">Birdie</button>
                <button class="filter-btn" onclick="filterGallery('eagle')">Eagle</button>
                <button class="filter-btn" onclick="filterGallery('hotStreak')">Hot Streak</button>
                <button class="filter-btn" onclick="filterGallery('story')">Messages</button>
            </div>
            <div class="gallery-grid" id="galleryGrid"></div>
            <button class="btn back-button" onclick="showScreen('dashboardScreen')">Back to Dashboard</button>
        </div>
    </div>

    <div id="claimModal" class="modal">
        <div class="modal-content">
            <h2 style="margin-bottom: 20px;">Claim a Coin</h2>
            <div class="coin-option" onclick="claimCoin('birdie')">
                <div class="coin-option-header">
                    
                    <span class="coin-option-name">Birdie Coin</span>
                </div>
                <div class="coin-option-desc">One under par</div>
            </div>
            <div class="coin-option" onclick="claimCoin('eagle')">
                <div class="coin-option-header">
                    
                    <span class="coin-option-name">Eagle Coin</span>
                </div>
                <div class="coin-option-desc">Two under par</div>
            </div>
            <div class="coin-option" onclick="claimCoin('hotStreak')">
                <div class="coin-option-header">
                    
                    <span class="coin-option-name">Hot Streak Coin</span>
                </div>
                <div class="coin-option-desc">Three pars in a row</div>
            </div>
            <div class="coin-option" onclick="showVoiceRecorder()">
                <div class="coin-option-header">
                    
                    <span class="coin-option-name">Birthday Wishes</span>
                </div>
                <div class="coin-option-desc">Send birthday message</div>
            </div>
            <button class="btn back-button" onclick="closeModal()">Cancel</button>
        </div>
    </div>

    <div id="voiceModal" class="modal">
        <div class="modal-content">
            <h2>Record Birthday Message</h2>
            <div class="voice-recorder">
                <button class="record-button" id="recordButton" onclick="toggleRecording()">üé§</button>
                <div class="timer" id="recordTimer">00:00</div>
                <p style="color: #666; margin: 15px 0;">Share your birthday wishes for Ray</p>
            </div>
            <button class="btn btn-primary" id="submitStory" onclick="submitStory()" style="display:none;">Submit Story</button>
            <button class="btn back-button" onclick="closeVoiceModal()">Cancel</button>
        </div>
    </div>

    <script>

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAp74qyQ-l0Tp8E5wGa6krxFxGVQkZeKIE",
            authDomain: "ray67birthday.firebaseapp.com",
            databaseURL: "https://ray67birthday-default-rtdb.firebaseio.com",
            projectId: "ray67birthday",
            storageBucket: "ray67birthday.firebasestorage.app",
            messagingSenderId: "789023107372",
            appId: "1:789023107372:web:f4bf41eb843c2ac53e6489"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const dataRef = database.ref('rays-birthday-2026');

        // Real-time listener for data updates
        let isInitialLoad = true;
        dataRef.on('value', (snapshot) => {
            const data = snapshot.val();
            if (data && !isInitialLoad && currentUser) {
                // Update dashboard when data changes
                updateDashboard();
            }
            isInitialLoad = false;
        });

const RAY_PHOTO = 'https://rays67birthday.complitrst.com/Ray-photo.png';
        
        const coinTypes = {
            birdie: { name: 'Birdie Coin', accent: 'blue', description: 'One under par', value: 1 },
            eagle: { name: 'Eagle Coin', accent: 'purple', description: 'Two under par', value: 1 },
            hotStreak: { name: 'Hot Streak Coin', accent: 'orange', description: 'Three pars in a row', value: 1 },
            story: { name: 'Birthday Wishes', accent: 'gold', description: 'Send birthday message', value: 2 },
            birthday: { name: 'Birthday Legend', accent: 'gold', description: 'Ray\'s special coin', value: 1 }
        };
        
        const COIN_GOAL = 67;

        const COIN_TYPES = {
            birdie: { name: 'Birdie Coin', accent: 'blue', value: 1 },
            eagle: { name: 'Eagle Coin', accent: 'purple', value: 1 },
            hotStreak: { name: 'Hot Streak Coin', accent: 'orange', value: 1 },
            birthday: { name: 'Birthday Wishes', accent: 'gold', value: 2 },
            ray: { name: 'Birthday Legend', accent: 'gold', value: 1 }
        };

        let currentUser = null;
        let isAdmin = false;
        let recording = false;
        let recordingInterval = null;
        let recordingSeconds = 0;
        let mediaRecorder = null;
        let audioChunks = [];
        let isRecording = false;
        let recordingStartTime = 0;
        let timerInterval = null;
        let currentFilter = 'all';

        // Photo handling
        let pendingPhotos = [];

        function handlePhotoUpload(event) {
            const files = event.target.files;
            const grid = document.getElementById('photoPreviewGrid');
            
            Array.from(files).forEach((file, index) => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const photoId = Date.now() + index;
                        pendingPhotos.push({
                            id: photoId,
                            data: e.target.result,
                            caption: ''
                        });
                        
                        const previewItem = document.createElement('div');
                        previewItem.className = 'photo-preview-item';
                        previewItem.innerHTML = `
                            <img src="${e.target.result}" alt="preview">
                            <button class="photo-delete" onclick="removePhoto(${photoId})">√ó</button>
                        `;
                        grid.appendChild(previewItem);
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Reset input
            event.target.value = '';
            
            // Show save button if not already visible
            if (pendingPhotos.length > 0 && !document.getElementById('savePhotosBtn')) {
                const saveBtn = document.createElement('button');
                saveBtn.id = 'savePhotosBtn';
                saveBtn.className = 'btn btn-primary';
                saveBtn.textContent = 'Save Photos';
                saveBtn.style.marginTop = '15px';
                saveBtn.onclick = savePhotos;
                document.querySelector('.photo-upload-section').appendChild(saveBtn);
            }
        }

        function removePhoto(photoId) {
            pendingPhotos = pendingPhotos.filter(p => p.id !== photoId);
            updatePhotoPreview();
        }

        function updatePhotoPreview() {
            const grid = document.getElementById('photoPreviewGrid');
            grid.innerHTML = '';
            
            pendingPhotos.forEach(photo => {
                const previewItem = document.createElement('div');
                previewItem.className = 'photo-preview-item';
                previewItem.innerHTML = `
                    <img src="${photo.data}" alt="preview">
                    <button class="photo-delete" onclick="removePhoto(${photo.id})">√ó</button>
                `;
                grid.appendChild(previewItem);
            });
            
            if (pendingPhotos.length === 0) {
                const saveBtn = document.getElementById('savePhotosBtn');
                if (saveBtn) saveBtn.remove();
            }
        }

        async function savePhotos() {
            if (pendingPhotos.length === 0) return;
            
            const data = await getData();
            if (!data.photos) {
                data.photos = [];
            }
            
            pendingPhotos.forEach(photo => {
                data.photos.push({
                    id: photo.id,
                    data: photo.data,
                    caption: photo.caption || '',
                    uploader: currentUser,
                    timestamp: Date.now()
                });
            });
            
            await saveData(data);
            
            // Clear pending photos
            pendingPhotos = [];
            updatePhotoPreview();
            
            // Remove save button
            const saveBtn = document.getElementById('savePhotosBtn');
            if (saveBtn) saveBtn.remove();
            
            alert('Photos saved! Check them out in the gallery.');
        }

        

        

        async function exportMemoryBook() {
            const data = await getData();
            
            // Calculate total coins
            let totalCoins = 0;
            Object.values(data.players).forEach(p => {
                p.coins.forEach(coin => {
                    const coinType = coinTypes[coin.type];
                    totalCoins += coinType ? coinType.value : 1;
                });
            });
            
            // Collect all coins with player info
            const allCoins = [];
            Object.values(data.players).forEach(player => {
                player.coins.forEach(coin => {
                    allCoins.push({
                        ...coin,
                        playerName: player.name,
                        coinType: coinTypes[coin.type]
                    });
                });
            });
            allCoins.sort((a, b) => a.timestamp - b.timestamp);
            
            // Collect all photos
            const photos = data.photos || [];
            
            // Build HTML sections
            let coinsHTML = '';
            allCoins.forEach(coin => {
                coinsHTML += '<div class="coin-item ' + coin.coinType.accent + '">' +
                    '<div class="coin-header">' +
                    '<span class="coin-name">' + coin.coinType.name + '</span>' +
                    '<span class="coin-player">by ' + coin.playerName + '</span>' +
                    '</div>' +
                    '<div class="coin-time">' + new Date(coin.timestamp).toLocaleString() + '</div>' +
                    '</div>';
            });
            
            let photosSection = '';
            if (photos.length > 0) {
                let photosHTML = '';
                photos.forEach(photo => {
                    photosHTML += '<div class="photo-item">' +
                        '<img src="' + photo.data + '" alt="Memory">' +
                        '<div class="photo-info">' +
                        '<div class="photo-uploader">' + photo.uploader + '</div>' +
                        (photo.caption ? '<div style="color:#666;margin:5px 0">' + photo.caption + '</div>' : '') +
                        '<div class="photo-time">' + new Date(photo.timestamp).toLocaleString() + '</div>' +
                        '</div></div>';
                });
                photosSection = '<div class="section"><h2 class="section-title">Photos from the Day (' + photos.length + ')</h2><div class="photo-grid">' + photosHTML + '</div></div>';
            }
            
            // Generate standalone HTML
            const memoryHTML = '<!DOCTYPE html>' +
'<html lang="en"><head><meta charset="UTF-8">' +
'<meta name="viewport" content="width=device-width, initial-scale=1.0">' +
'<title>Ray\'s 67th Birthday Memories - January 4, 2026</title>' +
'<style>*{margin:0;padding:0;box-sizing:border-box}' +
'body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;background:linear-gradient(135deg,#1a3a5c 0%,#0f2138 100%);min-height:100vh;padding:20px}' +
'.container{max-width:900px;margin:0 auto;background:white;border-radius:20px;padding:40px;box-shadow:0 10px 40px rgba(0,0,0,0.3)}' +
'.header{text-align:center;margin-bottom:40px;border-bottom:3px solid #d4af37;padding-bottom:30px}' +
'.header h1{color:#1a3a5c;font-size:2.5rem;margin-bottom:10px}' +
'.header .subtitle{color:#666;font-size:1.2rem}' +
'.goal-achieved{background:linear-gradient(135deg,#fff9e6 0%,#ffe9a8 100%);border:3px solid #d4af37;border-radius:16px;padding:30px;text-align:center;margin:30px 0}' +
'.goal-achieved h2{color:#1a3a5c;font-size:2rem;margin-bottom:10px}' +
'.goal-number{font-size:4rem;font-weight:bold;color:#d4af37}' +
'.section{margin:40px 0}' +
'.section-title{color:#1a3a5c;font-size:1.8rem;margin-bottom:20px;border-left:5px solid #d4af37;padding-left:15px}' +
'.coin-list{display:grid;gap:15px}' +
'.coin-item{background:#f8f9fa;padding:20px;border-radius:12px;border-left:5px solid #ccc}' +
'.coin-item.blue{border-left-color:#4A90E2}' +
'.coin-item.purple{border-left-color:#9B59B6}' +
'.coin-item.orange{border-left-color:#E67E22}' +
'.coin-item.gold{border-left-color:#d4af37}' +
'.coin-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}' +
'.coin-name{font-weight:600;color:#1a3a5c;font-size:1.1rem}' +
'.coin-player{color:#666;font-size:0.9rem}' +
'.coin-time{color:#999;font-size:0.85rem}' +
'.photo-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:20px;margin-top:20px}' +
'.photo-item{border-radius:12px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,0.1)}' +
'.photo-item img{width:100%;height:250px;object-fit:cover}' +
'.photo-info{padding:15px;background:#f8f9fa}' +
'.photo-uploader{font-weight:600;color:#1a3a5c;margin-bottom:5px}' +
'.photo-time{color:#999;font-size:0.85rem}' +
'.footer{text-align:center;margin-top:50px;padding-top:30px;border-top:2px solid #ddd;color:#666}' +
'</style></head><body><div class="container">' +
'<div class="header"><h1>Ray\'s 67th Birthday Memories</h1>' +
'<div class="subtitle">January 4, 2026 ‚Ä¢ Waterlefe Golf & River Club</div></div>' +
'<div class="goal-achieved"><h2>Goal Achievement</h2>' +
'<div class="goal-number">' + totalCoins + ' / 67</div>' +
'<p style="color:#666;margin-top:10px">' + (totalCoins >= 67 ? 'Goal Achieved!' : 'Coins Collected') + '</p></div>' +
'<div class="section"><h2 class="section-title">Birthday Moments (' + allCoins.length + ')</h2>' +
'<div class="coin-list">' + coinsHTML + '</div></div>' +
photosSection +
'<div class="footer"><p>Created with love on Ray\'s 67th Birthday</p>' +
'<p style="margin-top:5px;font-size:0.9rem">Waterlefe Golf & River Club ‚Ä¢ January 4, 2026</p></div>' +
'</div></body></html>';
            
            // Create download
            const blob = new Blob([memoryHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Rays-67th-Birthday-Memories.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('Memory book exported! Ray can open this file anytime to relive his special day.');
        }


        async function clearAllData() {
            if (!currentUser || currentUser.toLowerCase() !== 'tmac') {
                alert('Only TMac can clear all data');
                return;
            }
            
            if (!confirm('Are you SURE you want to clear ALL data? This cannot be undone!')) {
                return;
            }
            
            if (!confirm('This will delete everything - all players, coins, and photos. Really clear everything?')) {
                return;
            }
            
            const initialData = {
                players: {},
                photos: []
            };
            await dataRef.set(initialData);
            await updateDashboard();
            alert('All data has been cleared. Starting fresh!');
        }

        async function initData() {
            const snapshot = await dataRef.once('value');
            if (!snapshot.exists()) {
                const initialData = {
                    players: {},
                    photos: []
                };
                await dataRef.set(initialData);
            }
        }

        async function getData() {
            const snapshot = await dataRef.once('value');
            return snapshot.val() || { players: {}, photos: [] };
        }

        async function saveData(data) {
            await dataRef.set(data);
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }

        async function login() {
            const name = document.getElementById('playerName').value.trim();
            if (!name) {
                alert('Please enter your name');
                return;
            }
            
            currentUser = name;
            document.getElementById('dashboardName').textContent = name;
            
            // Show admin button if TMac
            if (name.toLowerCase() === 'tmac') {
                document.getElementById('adminSection').style.display = 'block';
            }
            
            await updateDashboard();
            showScreen('dashboardScreen');
        }

        async function updateDashboard() {
            const data = await getData();
            const players = data.players || {};
            
            // Count coins
            let totalCoins = 0;
            Object.values(players).forEach(player => {
                totalCoins += player.coins.length;
            });
            
            // Update display
            const totalCoinsEl = document.getElementById('totalCoins');
            const goalProgressEl = document.getElementById('goalProgress');
            const goalPercentageEl = document.getElementById('goalPercentage');
            
            if (totalCoinsEl) totalCoinsEl.textContent = totalCoins;
            if (goalProgressEl) goalProgressEl.style.width = Math.min((totalCoins / 67) * 100, 100) + '%';
            if (goalPercentageEl) goalPercentageEl.textContent = Math.round((totalCoins / 67) * 100) + '%';
            
            // Update user's coins
            const userCoins = players[currentUser]?.coins || [];
            const coinsGrid = document.getElementById('coinsGrid');
            
            if (!coinsGrid) return;
            
            if (userCoins.length === 0) {
                coinsGrid.innerHTML = '<div class="empty-state">Start collecting coins!</div>';
            } else {
                coinsGrid.innerHTML = userCoins.map(coin => {
                    const coinType = COIN_TYPES[coin.type];
                    return `
                        <div class="coin ${coinType.accent} ${currentUser.toLowerCase() === 'ray' ? 'ray-special' : ''}" data-type="${coin.type}">
                            <img src="${RAY_PHOTO}" alt="coin">
                        </div>
                    `;
                }).join('');
            }
        }

        function showClaimModal() {
            document.getElementById('claimModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('claimModal').style.display = 'none';
        }

        async function claimCoin(type) {
            const data = await getData();
            const players = data.players || {};
            
            if (!players[currentUser]) {
                players[currentUser] = { coins: [] };
            }
            
            players[currentUser].coins.push({
                type: type,
                timestamp: Date.now(),
                playerName: currentUser
            });
            
            data.players = players;  // THIS WAS MISSING!
            await saveData(data);
            await updateDashboard();
            closeModal();
        }

        function showVoiceRecorder() {
            document.getElementById('voiceModal').style.display = 'flex';
        }

        function closeVoiceModal() {
            document.getElementById('voiceModal').style.display = 'none';
            if (mediaRecorder && mediaRecorder.state === 'recording') {
                stopRecording();
            }
        }

        async function toggleRecording() {
            if (!mediaRecorder || mediaRecorder.state === 'inactive') {
                await startRecording();
            } else {
                stopRecording();
            }
        }
function updateTimer() {
    const elapsed = Math.floor((Date.now() - recordingStartTime) / 1000);
    const minutes = Math.floor(elapsed / 60).toString().padStart(2, '0');
    const seconds = (elapsed % 60).toString().padStart(2, '0');
    
    const display = document.getElementById('recordTimer');
    if (display) {
        display.textContent = `${minutes}:${seconds}`;
    }
}

function stopRecording() {
    if (mediaRecorder && mediaRecorder.state === 'recording') {
        mediaRecorder.stop();
        isRecording = false;
        clearInterval(timerInterval);

        const recordBtn = document.getElementById('recordBtn');
        const display = document.getElementById('recordTimer');

        if (recordBtn) {
            recordBtn.textContent = 'üé§ Start Recording';
            recordBtn.style.background = '#2ecc71';
        }

        if (display) {
            display.textContent = '00:00';
        }
    }
}

       async function startRecording() {
    try {
        const permissionStatus = await navigator.permissions.query({ name: 'microphone' });
        if (permissionStatus.state === 'denied') {
            alert("Microphone access is blocked. Please enable it in your browser settings.");
            return;
        }

        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
        mediaRecorder = new MediaRecorder(stream);
        audioChunks = [];

        mediaRecorder.ondataavailable = (event) => {
            audioChunks.push(event.data);
        };

        mediaRecorder.onstop = () => {
            const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
            const reader = new FileReader();
            reader.onloadend = () => {
                window.recordedAudioData = reader.result.split(',')[1];
                playAudio(window.recordedAudioData); // Preview (optional)
            };
            reader.readAsDataURL(audioBlob);
            stream.getTracks().forEach(track => track.stop());
        };

        mediaRecorder.start();
        isRecording = true;
        recordingStartTime = Date.now();

        const recordBtn = document.getElementById('recordBtn');
        if (recordBtn) {
            recordBtn.textContent = '‚èπ Stop Recording';
            recordBtn.style.background = '#e74c3c';
        }

        updateTimer();
        timerInterval = setInterval(updateTimer, 100);
    } catch (error) {
        alert('Could not access microphone: ' + error.message);
        console.error(error);
    }
}


        async function submitStory() {
            const audioData = window.recordedAudioData;
            
            if (!audioData) {
                alert('Please record a birthday message first!');
                return;
            }
            
            const data = await getData();
            const players = data.players || {};
            
            if (!players[currentUser]) {
                players[currentUser] = { coins: [] };
            }
            
            players[currentUser].coins.push({
                type: 'birthday',
                timestamp: Date.now(),
                audio: audioData
            });
            
            await saveData(data);
            await updateDashboard();
            closeVoiceModal();
            
            window.recordedAudioData = null;
            alert('Birthday message saved! Worth 2 coins!');
        }

       function playAudio(audioData) {
    const audio = new Audio('data:audio/webm;base64,' + audioData);
    audio.play().catch(error => {
        console.error("Audio playback failed:", error);
    });
}

        async function showLeaderboard() {
            const data = await getData();
            const players = data.players || {};
            
            const leaderboard = Object.entries(players).map(([name, player]) => ({
                name,
                count: player.coins.length,
                value: player.coins.reduce((sum, coin) => sum + COIN_TYPES[coin.type].value, 0)
            })).sort((a, b) => b.value - a.value);
            
            const html = leaderboard.map((player, index) => `
                <div class="leaderboard-item">
                    <div class="leaderboard-rank">${index + 1}</div>
                    <div class="leaderboard-info">
                        <div class="leaderboard-name">${player.name}</div>
                        <div class="leaderboard-stats">${player.count} coins ‚Ä¢ ${player.value} points</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('leaderboardList').innerHTML = html || '<p style="text-align: center; color: #999;">No coins collected yet</p>';
            showScreen('leaderboardScreen');
        }

        function showGallery() {
            showScreen('galleryScreen');
            filterGallery('all');
        }

        async function filterGallery(filter) {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase().includes(filter) || (filter === 'all' && btn.textContent === 'All'));
            });
            
            const data = await getData();
            const players = data.players || {};
            const grid = document.getElementById('galleryGrid');
            
            grid.innerHTML = '';
            
            // Handle 'coins' filter - show all coin types
            const isCoinFilter = filter === 'coins';
            const isPhotoFilter = filter === 'photos';
            
            Object.entries(players).forEach(([playerName, player]) => {
                player.coins.forEach(coin => {
                    const coinType = COIN_TYPES[coin.type];
                    
                    // Show if: all, OR matching coin type, OR 'coins' filter showing all coins
                    const shouldShow = filter === 'all' || 
                                      coin.type === filter || 
                                      (isCoinFilter && !coin.photo) ||
                                      (isPhotoFilter && coin.photo);
                    
                    if (shouldShow) {
                        const item = document.createElement('div');
                        item.className = 'gallery-item';
                        item.innerHTML = `
                            <div class="coin ${coinType.accent} ${playerName.toLowerCase() === 'ray' ? 'ray-special' : ''}" style="width: 80px; height: 80px; margin: 0 auto 10px;">
                                <img src="${RAY_PHOTO}" alt="coin">
                            </div>
                            <div style="font-weight: 600; color: #1a3a5c;">${playerName}</div>
                            <div style="font-size: 0.9rem; color: #666;">${coinType.name}</div>
                            <div style="font-size: 0.8rem; color: #999;">${new Date(coin.timestamp).toLocaleString()}</div>
                            ${coin.audio ? `<button class="btn" style="margin-top: 10px; padding: 5px 15px; font-size: 0.85rem;" onclick="playAudio('${coin.audio}')">‚ñ∂ Play Message</button>` : ''}
                        `;
                        grid.appendChild(item);
                    }
                });
            });
            
            if (grid.children.length === 0) {
                grid.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #999; padding: 40px;">No coins in this category yet</p>';
            }
        }

        initData();
    </script>
</body>
</html>
